# Cluster集群概念##

李家宜    jenny1228.li@foxmail.com

----

[TOC]

## 集群概述##

* 集群是一组协同工作的服务实体

  集群是一组协同工作的服务实体，用以提供比单一服务实体更具扩展性和可用性的服务平台。

  从客户端看来，一个集群就是一个完整不可细分的实体，但事实上一个集群实体是由完成不同任务的服务节点个体所组成的。

* 集群实体的可扩展性

  集群实体的可扩展性是指，在集群运行的中新的服务节点可以动态的加入集群实体从而提升集群实体的综合性能。

* 集群实体的高可用性

  集群实体的高可用性是指,集群实体通过其内部的服务节点的冗余使客户端免予 OUT OF SERVICE 错误。简单的说，在集群中同一服务可以由多个服务节点提供，当部分服务节点失效后，其它服务节点可以接管服务。

* 集群实体地址

  集群实体地址是指客户端访问集群实体获取服务资源的唯一入口地址。负载均衡是指集群中的分发设备(服务)将用户的请求任务比较均衡(不是平均)分布到集群实体中的服务节点计算、存储和网络资源中。一般我们将提供负载均衡分发的设备叫做负载均衡器。

* 客户请求的负载均衡

  负载均衡器一般具备如下三个功能：

  1.维护集群地址

  2.负责管理各个服务节点的加入和退出

  3.集群地址向内部服务节点地址的转换

* 服务节点的错误恢复

  错误恢复是指集群中某个或某些服务节点(设备)不能正常工作(或提供服务)，其它类似服务节点(设备)可以资源透明和持续的完成原有任务。具备错误恢复能力是集群实体高可用性的必要条件。

  负责均衡和错误恢复都需要集群实体中各个服务节点中有执行同一任务的资源存在，而且对于同一任务的各个资源来说，执行任务所需的信息视图必须一致。

## 集群的主要类型##

 多台同构或异构的计算机用某种方式连接起来协同完成特定的任务就构成了集群系统。

目前 Linux 下的集群主要有三种类型：

* HA（High Availbility）高可用

  高可用性集群（High-availability clustering ）使用多个机器来为某个服务或某组服务提供额外的可靠性。

* LB（Load Balancing）负载均衡

  负载均衡集群（ Load-balance clustering ）使用特殊的路由技术来给一组服务器分配任务。

* HPC（High performance Computing）高性能计算

  + DC  (Distributed Computing)
  + PC  (Parallel Computing)

高性能计算集群（High Performance Compute clustering ）使用多个机器来为需要大量计算能力的任务提供更强大的计算能力。RHEL 没有内嵌这类集群的解决方案。

RedHat 提供了前两种集群技术的解决方案。使用一组程序来监视该系统和集群中的服务的健康状况。虽然集群系统并不能解决所有的系统问题,但是它能够帮助系统管理员最大限度地利用现有的资源。并不是所有的程序都适用于集群系统，但是常见的系统应用如 HTTP 服务，FTP 服务，数据库服务都可以利用集群系统来增强它们的功能。

## HA 集群##

* 通过特殊软件把独立的系统（node）连接起来，组成一个能够提供故障切换（Faileover）功能的集群。
* HA集群可以保证在多种故障中,关键服务的可用性、可靠性及数据完整性。
* HA集群主要用于文件服务，WEB 服务,数据库服务等关键应用。

可用性通常指系统的 uptime,在 7x24x365 的工作环境中，99%的可用性指在一年中可以有 87 小时 36 分钟的 DOWN 机时间，通常在关键服务中这种一天多的故障时间是无法接受的，所以提出了前面提到的错误恢复概念以满足 99.999%的可用性需求。

在 RHEL 中的 HA 集群技术和容错( fault  tolerance )并不是同义词。容错系统使用高度专业化的、通常非常昂贵的硬件来实现一个完全冗余的环境。在这个环境中运行的服务能够不被硬件失效中断。

容错系统并不容忍操作员和软件的错误，而 HA 集群却能够通过服务的冗余性来修正这类错误。此外，由于红帽企业Linux是为在通用廉价的硬件上运行而设计的,它所创造的系统高可用性环境的费用只是容错硬件费用的极少的一部分。

高可用性集群和多机热备技术有很大区别，但很多人会将其混淆。多机热备技术是指一台服务器作为主机，其它服务器做为备份机（可以不在加电状态称之为冷备，可以在加电状态称之为热备）当主机失效时，备份机通过人为的参与接管服务。

## LB集群 ##

* 在 LB 服务器上使用专门的路由算法，将数据包分散到多个真实服务器中进行处理，从而达到网络服务均衡负载的作用。
* Lb 服务器可以充分利用现有资源，提高高负载服务的性能，降低高负载服务的成本
* Lb 集群主要用于公共 WEB 服务、FTP 服务、数据库服务等高负载服务中。

对于使用服务的用户(如网站)，Linux虚拟服务器(LVS)集群看起来是一个服务器。事实上，该用户使用的是一对冗余LVS路由器之后的两个或多个服务器的集群。这对路由器把客户请求均衡地分配给集群系统。负载均衡集群的系统允许管理员使用常见廉价的硬件和Linux0，在满足可用性需求的同时还提供服务的连续持久的。

## 集群技术的优势 ##

* 低成本  
* 高可用  
* 高扩展  
* 高资源利用率

集群技术相对传统的大型机技术具有低成本的优势，购买与维护一个大型机的费用往往数倍于一个相同性能的集群系统。

通过高可用集群，我们可以构建可用度达到 99.999%的高可用服务，也就是在极端环境下，正常配置的高用服务可能达到每年 DownTime 不超过 6 分钟。

由于集群系统由多台计算机构成，一般性况下我们可以在不影响系统现有服务的情况下对系统进行扩充、升级、或是进行各种维护操作。同时其它扩展技术，通常仅仅支持几十个CPU 的扩展，扩展能力有限。而采取集群技术的集群实体则可以扩展成百上千的服务节点，每个服务节点有可以扩展多个 CPU,其扩展能力有明显优势。

在大型企业中经常会有大批的机器被淘汰，利用集群系统,我们可以将老旧的计算机连接在一起并行运做以提供高性能的服务。

## Linux 集群的优劣势##

优势：

* 稳定
* 高性能
* 兼容 UNIX 系统
* 开源的发展模式
* 兼容多种硬件平台
* 利于分发的纯文本配置文件
* 方便快捷的文本化管理界面

劣势：

* Linux 集群系统使用较为复杂
* Linux 集群软件大多基于 GPL 协议，用户担心无法得到完备的商业支持
* Linux 集群的相关人才稀少，培训成本大

## Linux 集群目前活跃的解决套件   ##

* 高可用性集群(HA)
  - RedHat  Cluster  Suite(RHCS)  
  - Linux-HA(Heartbeat)
  - keepalived
* 负载均衡集群(LB)
  - Linux  Virtual  Server(LVS)
* 分布式高性能计算(DC)
  - OpenMosix
  - OpenSSI
* 并行式高性能计算(PC)
  - Beowulf

RHCS 是由 RedHat 的集群套件系统,除了完成高可用性功能之外，它还具备负载均衡功能。

Heartbeat 是一个免费的开放源代码的高可用集群系统，目前已经被Novell(SuSE Linux)、Mandriva Linux、Debian GNU/Linux、Ubuntu Linux 等广泛使用。

LVS 项目于 1998 年 5 月在网站上发布 IPVS 第一个版本源程序，一直得到了来自Internet的用户和开发者的鼓励和支持。

LVS(Linux Virtual Server)的创始人和主要开发人员是中国的章文嵩博士，他目前工作于国家并行与分布式处理重点实验室，主要从事集群技术、操作系统、对象存储与数据库的研究。他一直在自由软件的开发上花费大量时间，并以此为乐。

高性能计算集群系统主要用于大规模科学计算环境，在企业中应用较少，搭建高性能计算集群往往会针对具体计算内容专门设计系统结构及应用软件。

虽然拥有很大的 Linux集群用户基础，openMosix项目仍被关闭。主要的开发者已经离开，他们缺乏继续下去的促动或者说能得到什么的回报。其官方声称多核CPU使得集群是多余的，夹杂在非常不可能和完全的不合理之中。从技术的角度看，开源的bproc(the Beowulf process migration module/Beowulf 进程迁移模块) 是陈旧的，除非你是一个研究者，否则MOSIX是非常难得获得的，而kerrighed仍是不成熟的。从用户的角度看，openMosix是开源集群世界中迄今为止最好的管理工具，但是它已经成为过去式了。